/**
 * 파일 위치: assets/js/select2-sortable.js
 * 역할: Select2 드래그앤드롭 정렬 기능 제공
 */

(function($) {'use strict';$.fn.select2Sortable = function() {const $select = $(this);if (!$select.length || !$select.hasClass('select2-hidden-accessible')) {console.warn('select2Sortable: Select2가 초기화되지 않았습니다.');return this;}$select.on('select2:select', function() {setTimeout(function() {applySortableToSelect($select);}, 10);});applySortableToSelect($select);return this;};function applySortableToSelect($select) {const $container = $select.next('.select2-container');const $choicesContainer = $container.find('.select2-selection__rendered');if (typeof $.fn.sortable === 'undefined') {console.error('select2Sortable: jQuery UI Sortable이 로드되지 않았습니다.');return;}if ($choicesContainer.hasClass('ui-sortable')) $choicesContainer.sortable('destroy');$choicesContainer.sortable({containment: 'parent', items: '.select2-selection__choice', tolerance: 'pointer', cursor: 'move', helper: 'clone', opacity: 0.8, update: function() {/* update 이벤트 사용 (stop 대신) */updateSelectOrder($select);}});}function updateSelectOrder($select) {/* 현재 선택된 모든 값 가져오기 */const currentValues = $select.val() || [];/* DOM에서 현재 순서 가져오기 */const $container = $select.next('.select2-container');const $choices = $container.find('.select2-selection__choice');const newOrder = [];const valueToText = {};/* 현재 선택된 값들의 텍스트 매핑 생성 */$select.find('option:selected').each(function() {valueToText[$(this).text()] = $(this).val();});/* 화면에 표시된 순서대로 값 추출 */$choices.each(function() {const text = $(this).attr('title');if (valueToText[text]) newOrder.push(valueToText[text]);});/* 값이 제대로 추출되었는지 확인 */if (newOrder.length === currentValues.length) {/* select 값 업데이트 (이벤트 트리거하지 않음) */$select.val(newOrder);}}$.fn.select2SortableDestroy = function() {const $select = $(this);const $container = $select.next('.select2-container');const $choicesContainer = $container.find('.select2-selection__rendered');if ($choicesContainer.hasClass('ui-sortable')) $choicesContainer.sortable('destroy');$select.off('select2:select');return this;};})(jQuery);
